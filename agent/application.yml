spring:
  application:
    name: embabel-note-gardener
  profiles:
    active: dry-run,ollama
  main:
    allow-bean-definition-overriding: true
    web-application-type: none
  autoconfigure:
    exclude:
      - org.springframework.ai.autoconfigure.openai.OpenAiAutoConfiguration
      - org.springframework.ai.model.bedrock.cohere.autoconfigure.BedrockCohereEmbeddingAutoConfiguration
      - org.springframework.ai.model.bedrock.titan.autoconfigure.BedrockTitanEmbeddingAutoConfiguration
      - org.springframework.ai.model.bedrock.cohere.autoconfigure.BedrockCohereChatAutoConfiguration
      - org.springframework.ai.model.bedrock.titan.autoconfigure.BedrockTitanChatAutoConfiguration
      - org.springframework.ai.model.bedrock.anthropic.autoconfigure.BedrockAnthropicChatAutoConfiguration
      - org.springframework.ai.model.bedrock.llama.autoconfigure.BedrockLlamaChatAutoConfiguration
      - org.springframework.ai.model.bedrock.jurassic2.autoconfigure.BedrockAi21Jurassic2ChatAutoConfiguration
      - com.embabel.agent.autoconfigure.platform.AgentPlatformAutoConfiguration
      - com.embabel.agent.autoconfigure.shell.ShellAutoConfiguration
  ai:
    model:
      llm: ${OLLAMA_CHAT_MODEL:gpt-oss:20b}
      embedding: ${OLLAMA_EMBEDDING_MODEL:nomic-embed-text:latest}
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
      chat:
        options:
          model: ${OLLAMA_CHAT_MODEL:gpt-oss:20b}
          temperature: 0.7
      embedding:
        options:
          model: ${OLLAMA_EMBEDDING_MODEL:nomic-embed-text:latest}

embabel:
  models:
    default-llm: ${OLLAMA_CHAT_MODEL:gpt-oss:20b}
    llms:
      better: ${OLLAMA_CHAT_MODEL:gpt-oss:20b}
      cheaper: ${OLLAMA_CHAT_MODEL:gpt-oss:20b}
      faster: ${OLLAMA_CHAT_MODEL:gpt-oss:20b}

gardener:
  # Path to org-roam notes directory
  notes-path: ${ORG_ROAM_PATH:~/org-roam}

  # Embeddings configuration
  embeddings:
    max-age-days: 90
    chunk-size: 1600
    chunk-overlap-percent: 12

  # Linking configuration
  linking:
    confidence-threshold: 0.72
    max-links-per-run: 7
    auto-link-source-notes: false

  # Health score weights (must sum to 100)
  health:
    weights:
      formatting: 10
      provenance: 25
      embeddings-freshness: 15
      links: 20
      taxonomy: 10
      contradictions-inverse: 10
      staleness-inverse: 10

  # Target health score for MaintainHealthyCorpus goal
  target-health: 90

  # Stale note threshold in days
  stale-threshold-days: 90

  # Backup directory (relative to notes-path)
  backup-dir: .gardener/backups

  # Proposals directory (relative to notes-path)
  proposals-dir: .gardener/proposals

  # Embeddings storage
  embeddings-db: ${user.home}/.gardener/embeddings.db

  # Taxonomy mapping file (YAML)
  taxonomy-map: ${gardener.notes-path}/taxonomy.yml

  # Scheduler configuration
  scheduler:
    enabled: true
    nightly-audit-cron: "0 0 2 * * *"  # 2 AM daily
    watch-debounce-ms: 5000

logging:
  level:
    com.dcruver.orgroam: INFO
    com.embabel: DEBUG
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

---
# Dry-run profile (default)
spring:
  config:
    activate:
      on-profile: dry-run

gardener:
  execution:
    mode: DRY_RUN
    apply-safe-actions: false
    create-proposals: true

---
# Auto profile
spring:
  config:
    activate:
      on-profile: auto

gardener:
  execution:
    mode: AUTO
    apply-safe-actions: true
    create-proposals: true
